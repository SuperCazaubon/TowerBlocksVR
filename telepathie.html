<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Three.js Cardboard Debug</title>
<style>
  body { margin:0; overflow:hidden; background:#000; }
  canvas { display:block; }
  .error-box {
    position: fixed;
    top:0;
    left:0;
    width:100%;
    background:red;
    color:white;
    padding:10px;
    z-index:9999;
    font-family: monospace;
    white-space: pre-wrap;
  }
</style>
</head>
<body>

<script type="module">
  // Gestion globale des erreurs
  window.addEventListener('error', e => {
    const div = document.createElement('div');
    div.className = 'error-box';
    div.innerText = e.message + "\n" + e.filename + ":" + e.lineno;
    document.body.appendChild(div);
  });

  window.addEventListener('unhandledrejection', e => {
    const div = document.createElement('div');
    div.className = 'error-box';
    div.innerText = 'Unhandled Promise Rejection:\n' + e.reason;
    document.body.appendChild(div);
  });

  // --- Code Three.js ---
  import * as THREE from "./cdn.jsdelivr.net/npm/three@0.151.3/build/three.module.js";
  import { StereoEffect } from "./cdn.jsdelivr.net/npm/three@0.151.3/examples/jsm/effects/StereoEffect.js";
  import { DeviceOrientationControls } from "./cdn.jsdelivr.net/npm/three@0.151.3/examples/jsm/controls/DeviceOrientationControls.js";

  // Scène
  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x202020);

  // Caméra
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(0, 1.6, 0);

  // Renderer
  const renderer = new THREE.WebGLRenderer({ antialias:true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  const effect = new StereoEffect(renderer);
  effect.setSize(window.innerWidth, window.innerHeight);

  // Lumières
  scene.add(new THREE.AmbientLight(0xffffff, 0.5));
  const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
  dirLight.position.set(5,10,5);
  scene.add(dirLight);

  // Sol
  const floor = new THREE.Mesh(
    new THREE.PlaneGeometry(20,20),
    new THREE.MeshPhongMaterial({color:0x333333})
  );
  floor.rotation.x = -Math.PI/2;
  scene.add(floor);

  // Cube
  const cube = new THREE.Mesh(
    new THREE.BoxGeometry(1,1,1),
    new THREE.MeshPhongMaterial({color:0xff5533})
  );
  cube.position.set(0,1.6,-2);
  scene.add(cube);

  // Contrôles orientation
  const controls = new DeviceOrientationControls(camera);
  controls.enabled = true;

  // Resize
  window.addEventListener("resize", ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
    effect.setSize(window.innerWidth, window.innerHeight);
  });

  // Animation
  function animate(){
    requestAnimationFrame(animate);
    cube.rotation.x += 0.01;
    cube.rotation.y += 0.01;
    controls.update();
    effect.render(scene,camera);
  }
  animate();

  console.log("Three.js scene initialized"); // Confirme que le code est exécuté
</script>
</body>
</html>
